<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>网易云扫码登录</title>
  <link rel="stylesheet" href="/static/style.css">
</head>
<body>
  <div class="container">
    <h2>扫码登录网易云音乐</h2>
    <img id="qrimg" src="" alt="二维码" />
    <p id="status">请使用网易云音乐APP扫码</p>
  </div>

  <script>
    async function loadQR() {
      let res = await fetch('/get_qr');
      let data = await res.json();
      document.getElementById('qrimg').src = data.qrimg;

      checkStatus();
    }

    async function checkStatus() {
      let interval = setInterval(async () => {
        let res = await fetch('/check_qr');
        let data = await res.json();
        document.getElementById('status').innerText = data.msg;
        if (data.code === 200) {
          clearInterval(interval);
          alert("登录成功！");
        }
      }, 3000);
    }

    loadQR();
  </script>
</body>
</html>
