<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <title>网易云扫码登录</title>
  <link rel="stylesheet" href="/static/style.css">
</head>
<body>
  <div class="container">
    <h2>扫码登录网易云音乐</h2>
    <button onclick="getQR()">获取二维码</button>
    <div id="qr-container"></div>
    <p id="status"></p>
  </div>

  <script>
    async function getQR() {
      const res = await fetch("/get_qr");
      const data = await res.json();
      document.getElementById("qr-container").innerHTML =
        `<img src="${data.data.qrimg}" width="200"/>`;
      
      // 开始轮询扫码状态
      checkStatus();
    }

    async function checkStatus() {
      const interval = setInterval(async () => {
        const res = await fetch("/check_qr");
        const data = await res.json();
        console.log(data);
        if (data.code === 803) { 
          document.getElementById("status").innerText = "✅ 登录成功！";
          clearInterval(interval);
        } else if (data.code === 800) {
          document.getElementById("status").innerText = "❌ 二维码已过期，请重新获取";
          clearInterval(interval);
        } else if (data.code === 801) {
          document.getElementById("status").innerText = "⌛ 等待扫码...";
        } else if (data.code === 802) {
          document.getElementById("status").innerText = "📱 已扫码，等待确认...";
        }
      }, 3000);
    }
  </script>
</body>
</html>
