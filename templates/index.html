<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <title>ç½‘æ˜“äº‘æ‰«ç ç™»å½•</title>
  <link rel="stylesheet" href="/static/style.css">
</head>
<body>
  <div class="container">
    <h2>æ‰«ç ç™»å½•ç½‘æ˜“äº‘éŸ³ä¹</h2>
    <button onclick="getQR()">è·å–äºŒç»´ç </button>
    <div id="qr-container"></div>
    <p id="status"></p>
  </div>

  <script>
    async function getQR() {
      const res = await fetch("/get_qr");
      const data = await res.json();
      document.getElementById("qr-container").innerHTML =
        `<img src="${data.data.qrimg}" width="200"/>`;
      
      // å¼€å§‹è½®è¯¢æ‰«ç çŠ¶æ€
      checkStatus();
    }

    async function checkStatus() {
      const interval = setInterval(async () => {
        const res = await fetch("/check_qr");
        const data = await res.json();
        console.log(data);
        if (data.code === 803) { 
          document.getElementById("status").innerText = "âœ… ç™»å½•æˆåŠŸï¼";
          clearInterval(interval);
        } else if (data.code === 800) {
          document.getElementById("status").innerText = "âŒ äºŒç»´ç å·²è¿‡æœŸï¼Œè¯·é‡æ–°è·å–";
          clearInterval(interval);
        } else if (data.code === 801) {
          document.getElementById("status").innerText = "âŒ› ç­‰å¾…æ‰«ç ...";
        } else if (data.code === 802) {
          document.getElementById("status").innerText = "ğŸ“± å·²æ‰«ç ï¼Œç­‰å¾…ç¡®è®¤...";
        }
      }, 3000);
    }
  </script>
</body>
</html>
